{% extends "base_provisioning.html" %}
{% load math %}
{% load static %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
    href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
    rel="stylesheet">
{% endblock %}

{% block content %}
<style>
    body {
        text-align: left;
        letter-spacing: 0.05em;
        font-family: "Lato", sans-serif;
        font-weight: 400;
        font-style: normal;


    }

    h1,
    h2,
    p {
        text-align: left;
        padding: 0;
        margin: 0;

    }

    img {
        max-width: 80px !important;
    }

    .center-box {
        position: fixed;
        top: 50vh;
        left: 50vw;
        transform: translate(-50%, -50%);
        background: #FFFFFF;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border: 1px solid #BDBDBD;
        padding: 5px 10px 0px 10px;
        border-radius: 5px;
        width: min(100%, 650px);
    }

    .warning {
        background-color: rgb(208, 238, 255);
    }

    a {
        display: inline;
    }

    .emptiness {
        height: 50vh;
    }

    tr td p {
        text-align: center;
    }

    .text-left {
        text-align: left !important;
    }

    .white-filter {
        filter: grayscale(100%) brightness(1000%);
    }

    .buttons-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
    }

    #modal-backdrop {
        background-color: rgba(0, 0, 0, 0.5);
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        display: none;
        overflow: auto;
    }

    #modal-backdrop .modal-container {
        background: white;
        width: min(1000px, 95%);
        display: flex;
        position: relative;
        align-items: center;
        height: fit-content;
        margin-inline: auto;
        margin-top: 5vh;
        gap: 20px;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    #modal-backdrop .content {
        display: flex;
        flex-direction: column;
        text-align: justify;
        width: 50%;
    }

    #modal-backdrop .content .header {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    #modal-backdrop .content .header p {
        text-align: left;
    }

    #modal-backdrop .content h2 {
        font-family: 'Lato', sans-serif;
        font-weight: 400;
        font-size: 24px;
        line-height: 28.8px;
    }

    #modal-backdrop .content p {
        font-family: 'Lato', sans-serif;
        font-weight: 400;
        font-size: 18px;
        line-height: 21.6px;
    }

    #modal-backdrop .content .back-button {
        width: 90px;
        background: none;
        border: none;
        color: #0097CF;
        font-size: 14px;
        cursor: pointer;
        margin-top: 10px;
        text-align: left;
        display: none;
    }

    #modal-backdrop .content .back-button:hover {
        text-decoration: underline;
    }

    #modal-backdrop .content .os-options {
        padding: 16px;
        width: 100%;
    }

    #modal-backdrop .content .os-options span {
        font-size: 18px;
    }

    #modal-backdrop .content .os-options .os-list {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: nowrap;
    }

    .os-item {
        cursor: pointer;
        border: 1px solid transparent;
        display: flex;
        justify-content: center;
        align-items: center;
        width: min(140px, 100%);
        height: 140px;
        background: #F9F9F9;
    }

    #modal-backdrop .content .footer {
        text-align: center;
        padding-top: 14px;
    }

    #modal-backdrop .content .footer a {
        color: #0097CF;
        text-decoration: none;
        font-family: 'Lato', sans-serif;
        font-size: 17px;
    }

    #modal-backdrop .supporting-material {
        flex-grow: 1;
    }

    #modal-backdrop .supporting-material p {
        font-size: 18px;
    }

    #modal-backdrop .close-button {
        border: none;
        background: none;
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 30px;
    }

    .selected {
        background: #EEF9FE;
        border-radius: 8px;
        border: 1px solid #0097CF;
    }

    #steps-container {
        display: none;
        flex-direction: column;
        gap: 5px;
    }

    #steps-container .step-details.open {
        border: 1px solid #0097CF;
    }

    .step-details.open svg {
        transform: rotate(90deg);
    }

    .step-details.open svg path {
        fill: #0097CF;
        stroke-width: 1px;
    }

    .step-details.open .step-summary {
        color: #0097CF;
    }

    .step-details.open p {
        text-align: justify;
    }

    .step-details.open>div>span {
        display: block;
        padding-top: 8px;
    }

    .step-details.open a {
        text-decoration: none;
        color: #0097CF;
    }

    .step-details.open a:hover {
        text-decoration: underline;
    }

    #steps-container {
        margin-top: 10px;
        display: flex;
        gap: 8px;
    }

    #steps-container .step-details {
        border: 1px solid #DADADA;
        border-radius: 5px;
        padding: 12px;
    }

    #steps-container .step-details .step-summary {
        list-style-type: none;
        font-size: 18px;
        font-family: "Space Grotesk", sans-serif;
        display: flex;
        cursor: pointer;
    }

    #steps-container .step-details .step-summary .stepTitle {
        padding-right: 20px;
    }

    #steps-container .step-details .step-summary .svgContent {
        padding: 5px;
        display: flex;
        margin-left: auto;
        align-items: center;
    }

    .step-details .step-content {
        height: 0;
        overflow: hidden;
    }

    .step-details.open .step-content {
        height: auto;
        padding: 10px 0;
        transition: all 0.2s ease-in-out;
    }

    .step-details.open .step-content p {
        font-size: 15px !important;
    }

    .custom-checkbox {
        margin-right: 8px;
        width: 15px;
        height: 15px;
        border: 2px solid #DADADA;
        border-radius: 1.6px;
        display: inline-block;
        position: relative;
        cursor: pointer;
    }

    .custom-checkbox.checked {
        border: 1px solid #3182ce;
        background: #3182ce;
    }

    .custom-checkbox.checked::after {
        content: '';
        position: absolute;
        left: 5px;
        top: 0px;
        width: 3px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }

    #steps-container details p {
        font-size: 14px !important;
    }

    #video-container {
        margin-top: 20px;
        border-radius: 10px;
        overflow: hidden;
    }

    pre {
        padding: 10px;
        background: #2d2d2d;
        border-radius: 3px;
        margin: 4px 0;
    }

    pre code {
        color: white;
        line-height: normal;
        padding: 0;
    }

    code {
        background: #2d2d2d;
        padding: 3px;
        border-radius: 3px;
        color: white;
    }

    @media (min-width: 520px) {
        .buttons-container {
            flex-direction: row;
        }
    }

    @media (max-width: 750px) {
        #modal-backdrop .content {
            width: 100%;
        }

        #modal-backdrop .content .os-options .os-list {
            gap: 20px;
        }

        #modal-backdrop .supporting-material {
            display: none;
        }
    }
</style>
</head>

<body>
    <div class="col-12 col-sm-8 center-box">
        <img class="mt-3" src="{% static 'img/provisioning.png' %}" alt="provisioning bridge logo">
        <h1 class="text-center" style="font-size: 32px; font-weight: 600;">Start coding in just one click</h1>
        <p class="mt-4 mb-4 text-center" style="font-size: 16px;">
            Now, you can instantly open this project on VSCode, with no installations and instant feedback from Rigobot
            (our internally developed AI). Choose one of the following vendors:
        </p>
        <div class="buttons-container">
            {% if buttons %}
            {% for button in buttons %}
            <button class="d-flex gap-1 align-items-center btn"
                style="font-size: 15px; font-weight: 600; width: 200px; background-color: #0097CF; color: white; justify-content: center;">
                <img class="white-filter" src="{{ button.icon }}" style="margin-right: 5px;" />
                <a class="page-link" href="{{ button.url }}">{{ button.label }}</a>
            </button>
            {% endfor %}
            {% else %}
            <p>No buttons available.</p>
            {% endif %}
            <button class="toggler d-flex gap-1 align-items-center btn" onclick="toggleModal(event, true)"
                style="font-size: 15px; font-weight: 600; width: 200px; background-color: #0097CF; color: white; justify-content: center;">
                <img class="toggler white-filter" src="/static/img/button-locally.svg" style="margin-right: 5px;" />
                <a class="toggler page-link">Start locally</a>
            </button>
        </div>
        <div class="row p-2 mt-4" style="font-size: 14px;">
            <div class="col-12" style="display: flex; flex-direction: column; gap: 8px;">
                <p>Setup and configuration are big barriers to learning coding-related skills;</p>
                <p>That's why we developed the <a target="_blank" href="https://4geeks.com/provisioning">4Geeks Click
                        and Code
                    </a> and <a targe="_blank" href="https://www.learnpack.co">LearnPack</a>.</p>
            </div>
        </div>
    </div>

    <div class="emptiness"></div>

    <div id="modal-backdrop" class="toggler" onclick="toggleModal(event, false)">
        <div class="modal-container">
            <div class="content">
                <div class="header">
                    <h2>Open locally on your computer</h2>
                    <p>This example can be downloaded and run locally on your computer by following these steps:</p>
                </div>
                <button class="back-button" onclick="goBack()">← Go back</button>
                <div class="os-options">
                    <strong>
                        <span>Select your operating system</span>
                    </strong>
                    <div class="os-list">
                        <div class="os-item" onclick="handleOsItemClick(event)">
                            <img src="/static/img/os-ios.svg" alt="macos">
                        </div>
                        <div class="os-item" onclick="handleOsItemClick(event)">
                            <img src="/static/img/os-linux.svg" alt="linux">
                        </div>
                        <div class="os-item" onclick="handleOsItemClick(event)">
                            <img src="/static/img/os-windows.svg" alt="windows">
                        </div>
                    </div>
                </div>
                <div id="steps-container"></div>
                <footer class="footer">
                    <a href="https://4geeks.com/mentorship/schedule" target="_blank">Need help? Schedule a mentoring
                        session →</a>
                </footer>
            </div>
            <div class="supporting-material">
                <!-- <p>Supporting material for each step will be shown here.</p> -->
                <div id="video-container"></div>
                <button class="toggler close-button" onclick="toggleModal(false)">&times;</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous">
    </script>
    <script>
        let jsonSteps = {}

        fetch("{% static 'assets/clone_modal.json' %}")
            .then(response => response.json())
            .then(data => {
                const jsonData = data;

                jsonSteps = jsonData
            })
            .catch(error => console.error('Error al cargar el JSON:', error));


        const svgContent = '<svg width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.79289 13.7071C3.40237 13.3166 3.40237 12.6834 3.79289 12.2929L9.08579 7L3.7929 1.70711C3.40237 1.31658 3.40237 0.683417 3.7929 0.292893C4.18342 -0.0976312 4.81659 -0.0976311 5.20711 0.292894L11.2071 6.2929C11.5976 6.68342 11.5976 7.31659 11.2071 7.70711L5.20711 13.7071C4.81658 14.0976 4.18342 14.0976 3.79289 13.7071Z" fill="#00041A"/></svg>'
        const agent = "{{agent}}"

        function displayVideo(url) {
            const videoId = url.split('v=')[1].split('&')[0];
            const iframe = document.createElement('iframe');
            const modalContainer = document.querySelector('.content')
            const height = modalContainer.offsetHeight;

            iframe.width = '100%';
            iframe.height = height;
            iframe.src = `https://www.youtube.com/embed/${videoId}`;
            iframe.frameBorder = '0';
            iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
            iframe.allowFullscreen = true;

            const videoContainer = document.querySelector('#video-container');
            videoContainer.innerHTML = '';
            videoContainer.appendChild(iframe);
        }

        function toggleModal(event, show = true) {
            const modal = document.getElementById("modal-backdrop");
            if (event.target.classList.contains('toggler')) {
                modal.style.display = show ? "flex" : "none";
            }
        }

        function handleOsItemClick(event) {
            const osItems = document.querySelectorAll('.os-item');
            osItems.forEach(item => item.classList.remove('selected'));
            event.currentTarget.classList.add('selected');

            const osType = event.currentTarget.querySelector('img').alt;
            const osListContainer = document.querySelector('.os-options');
            const backButton = document.querySelector('.back-button');

            setTimeout(() => {
                displaySteps(osType);
                osListContainer.style.display = 'none';
                backButton.style.display = 'block';
            }, 200);
        }

        function displaySteps(osType) {

            console.log(jsonSteps);

            const lastStep = agent === "os" ? {
                ...jsonSteps["agent-os"]
            } : { ...jsonSteps["agent-vs-code"] }

            const osSteps = [...jsonSteps["os-list"].find(os => os.name === osType).steps, lastStep]
            const stepsContainer = document.getElementById('steps-container');
            stepsContainer.innerHTML = '';

            if (osSteps) {
                osSteps.forEach((step, index) => {
                    const stepDetails = document.createElement('div');
                    stepDetails.classList.add('step-details');

                    if ("video" in step && step.video) {
                        stepDetails.setAttribute('urlVideo', step.video);
                    }

                    const stepSummary = document.createElement('div');
                    stepSummary.classList.add('step-summary');

                    const checkbox = `<div class="custom-checkbox" onclick="toggleCheckbox()"></div>`;

                    stepSummary.innerHTML = `<div>${checkbox}</div><div class="stepTitle"><span>${index + 1}. ${step.label}</span></div> <div class="svgContent">${svgContent}</div>`;
                    stepDetails.appendChild(stepSummary);

                    stepSummary.addEventListener("click", function (event) {
                        closeStep(event);
                    });

                    const stepContent = document.createElement('div');

                    stepContent.classList.add('step-content')
                    stepContent.innerHTML = `<p>${step.description.replace("[repoUrl]", "{{repo_url}}").replace("[repoName]", "{{repo_name}}")}</p> <span>${step.source ? `<a href="${step.source}" target="__blank">Learn more</a>` : ""}</span>`;
                    stepDetails.appendChild(stepContent);
                    stepsContainer.appendChild(stepDetails);
                });
                stepsContainer.style.display = 'flex';
            } else {
                console.error('No steps found for the operating system');
            }
        }

        function toggleCheckbox() {
            const checkbox = event.target;
            checkbox.classList.toggle('checked');
        }

        function goBack() {
            const osListContainer = document.querySelector('.os-options');
            const stepsContainer = document.getElementById('steps-container');

            osListContainer.style.display = 'block';
            stepsContainer.style.display = 'none';

            const backButton = document.querySelector('.back-button');
            backButton.style.display = 'none';

            const osItems = document.querySelectorAll('.os-item');
            osItems.forEach(item => item.classList.remove('selected'));

            const videoContainer = document.querySelector('#video-container');
            videoContainer.innerHTML = '';
        }

        function closeStep(event) {
            const clickedDetails = event.target.closest('div.step-details')
            const checkbox = clickedDetails.querySelector('.custom-checkbox')
            const allDetails = document.querySelectorAll('div.step-details')
            const videoContainer = document.querySelector('#video-container');
            const isOpen = clickedDetails.classList.contains('open')

            if(event.target === checkbox) return

            allDetails.forEach(detail => {
                detail.classList.remove('open');
            });

            if (!isOpen) {
                clickedDetails.classList.add('open');
                const urlVideo = clickedDetails.getAttribute('urlVideo');

                if (urlVideo) {
                    displayVideo(urlVideo);
                }
                else {
                    videoContainer.innerHTML = '';
                }
            } else {
                clickedDetails.classList.remove('open');
                checkbox.classList.remove('checked');
                videoContainer.innerHTML = '';
            }
        }
    </script>
</body>
{% endblock %}
